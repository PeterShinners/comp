---
List recently starred repos with star counts
Inspired by the excellent Nushell introduction
https://julianhofer.eu/blog/2025/nushell/#format-table-in-markdown-format
---

!import gh ("github-comp@1.0.2" comp)
!import table ("table" comp)


main = (:
	{
		repo = "https://github.com/PeterShinners/comp" 
		after = |> datetime.now - 1[week]
	}
	-> top-issues
	-> rename-fields[thumbs-up="ğŸ‘"]
	-> table.markdown
)


-- Top issues created recently
top-issues = (:repo~git-uri :count~num=10 :after~datetime
	{repo fields=("created-at" "reaction-groups" "title" "url")}
	-> gh.issues
	-> filter (:i 
		i.created-at >= after)
	-> map ..{:i
		thumbs-up = i.reaction-groups -> count [:r r.content == "thumbs-up"] 
	}
	-> sort[thumbs-up=descending]
	-> head[count]
)
