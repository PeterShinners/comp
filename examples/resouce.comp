!handle %readfile

!shape FileData& = {
    fd ~number
    path ~string
    mode ~string
}

!require read
!func open_for_read ~{path ~string} = {
    $fd = {path mode="r"} |open.syscall
    $fd -> !resource %readfile {
        release = [$fd |close.syscall]
    }
    & = {$fd path "r"} ~FileData
}

!require read
!func read_line ~{handle %readfile} = {
    handle&.fd |read_line.syscall
}
