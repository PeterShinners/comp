{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Comp",
  "patterns": [
    {
      "include": "#comments"
    },
    {
      "include": "#definitions"
    },
    {
      "include": "#pipelines"
    },
    {
      "include": "#strings"
    },
    {
      "include": "#numbers"
    },
    {
      "include": "#tags"
    },
    {
      "include": "#shapes"
    },
    {
      "include": "#function-references"
    },
    {
      "include": "#scopes"
    },
    {
      "include": "#constants"
    },
    {
      "include": "#operators"
    },
    {
      "include": "#blocks"
    }
  ],
  "repository": {
    "comments": {
      "name": "comment.line.semicolon.comp",
      "match": ";.*$"
    },
    "definitions": {
      "patterns": [
        {
          "name": "meta.definition.function.comp",
          "begin": "^\\s*(!func)\\s+(\\|[\\w.-]+(?:/[\\w.-]+)?)",
          "beginCaptures": {
            "1": {
              "name": "keyword.declaration.function.comp"
            },
            "2": {
              "name": "entity.name.function.definition.comp"
            }
          },
          "end": "(?<=\\})|$",
          "patterns": [
            {
              "include": "#shape-annotations"
            },
            {
              "match": "\\b(arg)\\b",
              "name": "keyword.parameter.comp"
            },
            {
              "include": "#shapes"
            },
            {
              "include": "#operators"
            },
            {
              "include": "$self"
            }
          ]
        },
        {
          "name": "meta.definition.shape.comp",
          "begin": "^\\s*(!shape)\\s+(~[\\w.-]+(?:/[\\w.-]+)?)",
          "beginCaptures": {
            "1": {
              "name": "keyword.declaration.shape.comp"
            },
            "2": {
              "name": "entity.name.type.definition.comp"
            }
          },
          "end": "(?<=\\})|$",
          "patterns": [
            {
              "include": "#shape-field-definitions"
            },
            {
              "include": "$self"
            }
          ]
        },
        {
          "name": "meta.definition.tag.comp",
          "begin": "^\\s*(!tag)\\s+(#[\\w.-]+)",
          "beginCaptures": {
            "1": {
              "name": "keyword.declaration.tag.comp"
            },
            "2": {
              "name": "entity.name.tag.definition.comp"
            }
          },
          "end": "(?<=\\})|$",
          "patterns": [
            {
              "include": "#tags"
            },
            {
              "include": "#operators"
            },
            {
              "include": "$self"
            }
          ]
        },
        {
          "name": "meta.definition.import.comp",
          "match": "^\\s*(!import)\\s+(/\\w+)\\s*(=)\\s*(\\w+)\\s+(.*)$",
          "captures": {
            "1": {
              "name": "keyword.declaration.import.comp"
            },
            "2": {
              "name": "entity.name.namespace.comp"
            },
            "3": {
              "name": "keyword.operator.assignment.comp"
            },
            "4": {
              "name": "support.type.import-source.comp"
            },
            "5": {
              "patterns": [
                {
                  "include": "#strings"
                }
              ]
            }
          }
        },
        {
          "name": "keyword.declaration.doc.comp",
          "match": "^\\s*!doc\\b"
        }
      ]
    },
    "pipelines": {
      "name": "meta.pipeline.comp",
      "begin": "\\[",
      "end": "\\]",
      "beginCaptures": {
        "0": {
          "name": "punctuation.section.pipeline.begin.comp"
        }
      },
      "endCaptures": {
        "0": {
          "name": "punctuation.section.pipeline.end.comp"
        }
      },
      "patterns": [
        {
          "include": "#pipeline-operators"
        },
        {
          "include": "$self"
        }
      ]
    },
    "pipeline-operators": {
      "patterns": [
        {
          "name": "keyword.operator.pipeline.function.comp",
          "match": "\\|[\\w.-]+(?:/[\\w.-]+)?"
        },
        {
          "name": "keyword.operator.pipeline.fallback.comp",
          "match": "\\|\\?"
        },
        {
          "name": "keyword.operator.pipeline.wrench.comp",
          "match": "\\|-\\|"
        },
        {
          "name": "keyword.operator.pipeline.struct.comp",
          "match": "\\|\\{"
        },
        {
          "name": "keyword.operator.pipeline.block.comp",
          "match": "\\|:"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.triple.comp",
          "begin": "\"\"\"",
          "end": "\"\"\"",
          "patterns": [
            {
              "name": "constant.character.escape.comp",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.double.comp",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.comp",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.interpolated.comp",
          "begin": "%\"",
          "end": "\"",
          "patterns": [
            {
              "name": "meta.embedded.expression.comp",
              "begin": "\\$\\{",
              "end": "\\}",
              "patterns": [
                {
                  "include": "$self"
                }
              ]
            },
            {
              "name": "constant.character.escape.comp",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.hex.comp",
          "match": "\\b0[xX][0-9a-fA-F_]+\\b"
        },
        {
          "name": "constant.numeric.binary.comp",
          "match": "\\b0[bB][01_]+\\b"
        },
        {
          "name": "constant.numeric.octal.comp",
          "match": "\\b0[oO][0-7_]+\\b"
        },
        {
          "name": "constant.numeric.float.comp",
          "match": "\\b\\d[\\d_]*\\.\\d[\\d_]*(?:[eE][+-]?\\d[\\d_]*)?\\b"
        },
        {
          "name": "constant.numeric.float.comp",
          "match": "\\b\\.\\d[\\d_]*(?:[eE][+-]?\\d[\\d_]*)?\\b"
        },
        {
          "name": "constant.numeric.float.comp",
          "match": "\\b\\d[\\d_]*[eE][+-]?\\d[\\d_]*\\b"
        },
        {
          "name": "constant.numeric.integer.comp",
          "match": "\\b\\d[\\d_]*\\b"
        }
      ]
    },
    "tags": {
      "patterns": [
        {
          "name": "constant.language.tag.comp",
          "match": "#(?:true|false|break|skip)\\b"
        },
        {
          "name": "entity.name.tag.comp",
          "match": "#[\\w.-]+(?:/[\\w.-]+)?"
        },
        {
          "name": "entity.name.tag.indexed.comp",
          "match": "#\\d+"
        },
        {
          "name": "entity.name.tag.computed.comp",
          "begin": "#\\(",
          "end": "\\)",
          "patterns": [
            {
              "include": "$self"
            }
          ]
        }
      ]
    },
    "shapes": {
      "patterns": [
        {
          "name": "storage.type.shape.builtin.comp",
          "match": "~(?:num|str|bool|nil|any)\\b"
        },
        {
          "name": "storage.type.shape.comp",
          "match": "~[\\w.-]+(?:/[\\w.-]+)?"
        },
        {
          "name": "meta.shape.inline.comp",
          "begin": "~\\{",
          "end": "\\}",
          "patterns": [
            {
              "include": "#shape-field-definitions"
            },
            {
              "include": "$self"
            }
          ]
        },
        {
          "name": "meta.shape.block.comp",
          "begin": "~:\\{",
          "end": "\\}",
          "patterns": [
            {
              "include": "#shape-field-definitions"
            },
            {
              "include": "$self"
            }
          ]
        }
      ]
    },
    "shape-annotations": {
      "patterns": [
        {
          "match": "([\\w.-]+)(\\?)?\\s*(~[\\w.-]+(?:/[\\w.-]+)?)",
          "captures": {
            "1": {
              "name": "variable.parameter.comp"
            },
            "2": {
              "name": "keyword.operator.optional.comp"
            },
            "3": {
              "name": "storage.type.shape.comp"
            }
          }
        }
      ]
    },
    "shape-field-definitions": {
      "patterns": [
        {
          "match": "([\\w.-]+)(\\?)?\\s*(~[\\w.-]+(?:/[\\w.-]+)?)?",
          "captures": {
            "1": {
              "name": "variable.parameter.field.comp"
            },
            "2": {
              "name": "keyword.operator.optional.comp"
            },
            "3": {
              "name": "storage.type.shape.comp"
            }
          }
        },
        {
          "name": "keyword.operator.spread.comp",
          "match": "\\.\\."
        }
      ]
    },
    "function-references": {
      "patterns": [
        {
          "name": "entity.name.function.reference.comp",
          "match": "\\|[\\w.-]+(?:/[\\w.-]+)?"
        }
      ]
    },
    "scopes": {
      "patterns": [
        {
          "name": "variable.language.scope.comp",
          "match": "\\$(?:in|out|arg|ctx|mod|var)\\b"
        },
        {
          "name": "variable.other.scope.comp",
          "match": "\\$[\\w.-]+"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.placeholder.comp",
          "match": "\\?\\?\\?"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.morph.strong.comp",
          "match": "~\\*"
        },
        {
          "name": "keyword.operator.morph.weak.comp",
          "match": "~\\?"
        },
        {
          "name": "keyword.operator.morph.comp",
          "match": "~"
        },
        {
          "name": "keyword.operator.assignment.strong.comp",
          "match": "=\\*"
        },
        {
          "name": "keyword.operator.assignment.weak.comp",
          "match": "=\\?"
        },
        {
          "name": "keyword.operator.spread-assignment.strong.comp",
          "match": "\\.\\.\\.?=\\*"
        },
        {
          "name": "keyword.operator.spread-assignment.weak.comp",
          "match": "\\.\\.\\.?=\\?"
        },
        {
          "name": "keyword.operator.spread-assignment.comp",
          "match": "\\.\\.\\.?="
        },
        {
          "name": "keyword.operator.assignment.comp",
          "match": "="
        },
        {
          "name": "keyword.operator.logical.comp",
          "match": "&&|\\|\\||!!"
        },
        {
          "name": "keyword.operator.comparison.comp",
          "match": "==|!=|<=|>=|<|>"
        },
        {
          "name": "keyword.operator.fallback.comp",
          "match": "\\?\\?"
        },
        {
          "name": "keyword.operator.spread.comp",
          "match": "\\.\\."
        },
        {
          "name": "keyword.operator.power.comp",
          "match": "\\*\\*"
        },
        {
          "name": "keyword.operator.arithmetic.comp",
          "match": "\\+\\-|\\+|\\-|\\*|/|%"
        }
      ]
    },
    "blocks": {
      "patterns": [
        {
          "name": "meta.block.comp",
          "begin": ":\\{",
          "end": "\\}",
          "beginCaptures": {
            "0": {
              "name": "punctuation.section.block.begin.comp"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.section.block.end.comp"
            }
          },
          "patterns": [
            {
              "include": "$self"
            }
          ]
        }
      ]
    }
  },
  "scopeName": "source.comp"
}